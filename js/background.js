/*! formstone v0.8.35 [background.js] 2015-12-28 | MIT License | formstone.it */
!function(e,i){"use strict";function o(){b=e(f.base)}function t(i,o,t){if(o!==i.source){if(i.source=o,i.responsive=!1,i.isYouTube=!1,"object"===e.type(o)&&"string"===e.type(o.video)){var d=o.video.match(/(?:youtube\.com\/(?:[^\/]+\/.+\/|(?:v|e(?:mbed)?)\/|.*[?&]v=)|youtu\.be\/)([^"&?\/ ]{11})/i);d&&d.length>=1&&(i.isYouTube=!0,i.videoId=d[1])}var u=!i.isYouTube&&"object"===e.type(o)&&(o.hasOwnProperty("mp4")||o.hasOwnProperty("ogg")||o.hasOwnProperty("webm"));if(i.video=i.isYouTube||u,i.playing=!1,i.isYouTube)i.playerReady=!1,i.posterLoaded=!1,s(i,o,t);else if("object"===e.type(o)&&o.hasOwnProperty("poster"))n(i,o,t);else{var c=o;if("object"===e.type(o)){var l,p=[],y=[];for(l in o)o.hasOwnProperty(l)&&y.push(l);for(l in y.sort(m.sortAsc),y)y.hasOwnProperty(l)&&p.push({width:parseInt(y[l]),url:o[y[l]],mq:window.matchMedia("(min-width: "+parseInt(y[l])+"px)")});i.responsive=!0,i.sources=p,c=a(i)}r(i,c,!1,t)}}else i.$el.trigger(v.loaded)}function a(e){var o=e.source;if(e.responsive)for(var t in o=e.sources[0].url,e.sources)e.sources.hasOwnProperty(t)&&(i.support.nativeMatchMedia?e.sources[t].mq.matches&&(o=e.sources[t].url):e.sources[t].width<i.fallbackWidth&&(o=e.sources[t].url));return o}function r(i,o,t,a){var r=[h.media,h.image,!0!==a?h.animated:""].join(" "),n=e('<div class="'+r+'"><img></div>'),s=n.find("img"),u=o;s.one(v.load,(function(){w&&n.addClass(h.native).css({backgroundImage:"url('"+u+"')"}),n.fsTransition({property:"opacity"},(function(){t||d(i)})).css({opacity:1}),l(i),(!t||a)&&i.$el.trigger(v.loaded)})).attr("src",u),i.responsive&&n.addClass(h.responsive),i.$container.append(n),(s[0].complete||4===s[0].readyState)&&s.trigger(v.load),i.currentSource=u}function n(o,t,a){if(o.source&&o.source.poster&&(r(o,o.source.poster,!0,!0),a=!1),!i.isMobile){var n='<div class="'+[h.media,h.video,!0!==a?h.animated:""].join(" ")+'">';n+="<video",o.loop&&(n+=" loop"),o.mute&&(n+=" muted"),n+=">",o.source.webm&&(n+='<source src="'+o.source.webm+'" type="video/webm" />'),o.source.mp4&&(n+='<source src="'+o.source.mp4+'" type="video/mp4" />'),o.source.ogg&&(n+='<source src="'+o.source.ogg+'" type="video/ogg" />'),n+="</video>";var s=e(n+="</div>");s.find("video").one(v.loadedMetaData,(function(){s.fsTransition({property:"opacity"},(function(){d(o)})).css({opacity:1}),l(o),o.$el.trigger(v.loaded),o.autoPlay&&u(o)})),o.$container.append(s)}}function s(o,t,a){if(!o.videoId){var n=t.match(/^.*(?:youtu.be\/|v\/|e\/|u\/\w+\/|embed\/|v=)([^#\&\?]*).*/);o.videoId=n[1]}if(o.posterLoaded||(o.source.poster||(o.source.poster="//img.youtube.com/vi/"+o.videoId+"/0.jpg"),o.posterLoaded=!0,r(o,o.source.poster,!0,a),a=!1),!i.isMobile)if(e("script[src*='youtube.com/iframe_api']").length||e("head").append('<script src="//www.youtube.com/iframe_api"><\/script>'),T){var s=o.guid+"_"+o.youTubeGuid++,u='<div class="'+[h.media,h.embed,!0!==a?h.animated:""].join(" ")+'">';u+='<div id="'+s+'"></div>';var c=e(u+="</div>"),p=e.extend(!0,{},{controls:0,rel:0,showinfo:0,wmode:"transparent",enablejsapi:1,version:3,playerapiid:s,loop:o.loop?1:0,autoplay:1,origin:g.location.protocol+"//"+g.location.host},o.youtubeOptions);o.$container.append(c),o.player&&(o.oldPlayer=o.player,o.player=null),o.player=new g.YT.Player(s,{videoId:o.videoId,playerVars:p,events:{onReady:function(){o.playerReady=!0,o.mute&&o.player.mute(),o.autoPlay&&o.player.playVideo()},onStateChange:function(e){o.playing||e.data!==g.YT.PlayerState.PLAYING?o.loop&&o.playing&&e.data===g.YT.PlayerState.ENDED&&o.player.playVideo():(o.playing=!0,o.autoPlay||o.player.pauseVideo(),c.fsTransition({property:"opacity"},(function(){d(o)})).css({opacity:1}),l(o),o.$el.trigger(v.loaded)),o.$el.find(f.embed).addClass(h.ready)},onPlaybackQualityChange:function(){},onPlaybackRateChange:function(){},onError:function(){},onApiChange:function(){}}}),l(o)}else P.push({data:o,source:t})}function d(e){var i=e.$container.find(f.media);i.length>=1&&(i.not(":last").remove(),e.oldPlayer=null)}function u(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.playVideo();else{var i=e.$container.find("video");i.length&&i[0].play()}e.playing=!0}}function c(e){if(e.responsive){var i=a(e);i!==e.currentSource?r(e,i,!1,!0):l(e)}else l(e)}function l(e){for(var i=e.$container.find(f.media),o=0,t=i.length;t>o;o++){var a=i.eq(o),r=e.isYouTube?"iframe":a.find("video").length?"video":"img",n=a.find(r);if(n.length&&("img"!==r||!w)){var s=e.$el.outerWidth(),d=e.$el.outerHeight(),u=p(e,n);e.width=u.width,e.height=u.height,e.left=0,e.top=0;var c=e.isYouTube?e.embedRatio:e.width/e.height;e.height=d,e.width=e.height*c,e.width<s&&(e.width=s,e.height=e.width/c),e.left=-(e.width-s)/2,e.top=-(e.height-d)/2,a.css({height:e.height,width:e.width,left:e.left,top:e.top})}}}function p(i,o){if(i.isYouTube)return{height:500,width:500/i.embedRatio};if(o.is("img")){var t=o[0];if("undefined"!==e.type(t.naturalHeight))return{height:t.naturalHeight,width:t.naturalWidth};var a=new Image;return a.src=t.src,{height:a.height,width:a.width}}return{height:o[0].videoHeight,width:o[0].videoWidth}}var y=i.Plugin("background",{widget:!0,defaults:{autoPlay:!0,customClass:"",embedRatio:1.777777,loop:!0,mute:!0,source:null,youtubeOptions:{}},classes:["container","media","animated","responsive","native","fixed","ready"],events:{loaded:"loaded",ready:"ready",loadedMetaData:"loadedmetadata"},methods:{_construct:function(i){i.youTubeGuid=0,i.$container=e('<div class="'+h.container+'"></div>').appendTo(this),this.addClass([h.base,i.customClass].join(" "));var a=i.source;i.source=null,t(i,a,!0),o()},_destruct:function(e){e.$container.remove(),this.removeClass([h.base,e.customClass].join(" ")).off(v.namespace),o()},_resize:function(){m.iterate.call(b,c)},play:u,pause:function(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.pauseVideo();else{var i=e.$container.find("video");i.length&&i[0].pause()}e.playing=!1}},mute:function(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.mute();else{var i=e.$container.find("video");i.length&&(i[0].muted=!0)}e.playing=!0}e.mute=!0},unmute:function(e){if(e.video){if(e.isYouTube&&e.playerReady)e.player.unMute();else{var i=e.$container.find("video");i.length&&(i[0].muted=!1)}e.playing=!0}e.mute=!1},resize:l,load:t,unload:function(e){var i=e.$container.find(f.media);i.length>=1&&i.fsTransition({property:"opacity"},(function(){i.remove(),delete e.source})).css({opacity:0})}}}),f=y.classes,h=f.raw,v=y.events,m=y.functions,g=i.window,b=[],w="backgroundSize"in i.document.documentElement.style,T=!1,P=[];g.onYouTubeIframeAPIReady=function(){for(var e in T=!0,P)P.hasOwnProperty(e)&&s(P[e].data,P[e].source);P=[]}}(jQuery,Formstone);